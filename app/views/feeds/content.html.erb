<div class="feed-reader">
  <h1><%= @feed.title %></h1>
  <p class="feed-description"><%= @feed.description %></p>
  
  <div class="feed-meta">
    <p>
      <strong>Source:</strong> <%= link_to @feed.url, @feed.url, target: '_blank' %>
      <% if @feed.last_fetched_at %>
        | <strong>Last updated:</strong> <%= time_ago_in_words(@feed.last_fetched_at) %> ago
      <% end %>
    </p>
  </div>
  
  <div class="feed-actions">
    <%= button_to 'Refresh Feed', refresh_collection_feed_path(@collection, @feed), method: :post, class: 'btn btn-sm btn-info' %>
    <%= link_to 'Back to Collection', collection_path(@collection), class: 'btn btn-sm btn-secondary' %>
  </div>
  
  <% if @items.present? %>
    <div class="feed-items">
      <% @items.each do |item| %>
        <div class="feed-item card mb-4">
          <div class="card-header">
            <h3 class="card-title"><%= link_to item.title, item.link, target: '_blank' %></h3>
            <div class="card-meta">
              <% if item.published_at.present? %>
                <span class="text-muted me-3">
                  <i class="bi bi-calendar"></i> <%= item.published_at.strftime("%B %d, %Y at %I:%M %p") %>
                </span>
              <% end %>
              
              <% if item.author.present? %>
                <span class="text-muted me-3">
                  <i class="bi bi-person"></i> <%= item.author %>
                </span>
              <% end %>
              
              <span class="badge <%= item.content_type == 'video' ? 'bg-danger' : (item.content_type == 'audio' ? 'bg-success' : 'bg-primary') %>">
                <%= item.content_type.capitalize %>
              </span>
            </div>
          </div>
          
          <div class="card-body">
            <div class="feed-item-content">
              <% if item.is_video? %>
                <% if item.youtube_id %>
                  <div class="youtube-video-container mb-3">
                    <iframe width="560" height="315" 
                      src="https://www.youtube.com/embed/<%= item.youtube_id %>" 
                      frameborder="0" 
                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                      allowfullscreen></iframe>
                  </div>
                <% end %>
                
                <div class="feed-text-content">
                  <%= sanitize item.description %>
                </div>
              <% elsif item.is_audio? %>
                <% if item.audio_url %>
                  <div class="audio-player mb-3">
                    <audio controls class="w-100">
                      <source src="<%= item.audio_url %>" type="<%= item.enclosure_type || 'audio/mpeg' %>">
                      Your browser does not support the audio element.
                    </audio>
                  </div>
                <% end %>
                
                <div class="feed-text-content">
                  <%= sanitize item.description %>
                </div>
              <% else %>
                <%= sanitize item.description %>
              <% end %>
            </div>
          </div>
          
          <div class="card-footer">
            <%= link_to 'Read original', item.link, target: '_blank', class: 'btn btn-sm btn-outline-primary' %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="alert alert-info">
      <p>No items in this feed yet. Try refreshing the feed.</p>
    </div>
  <% end %>
</div> 