<h1><%= @feed.title %></h1>

<div class="feed-details">
  <p><strong>URL:</strong> <%= link_to @feed.url, @feed.url, target: '_blank' %></p>
  <p><strong>Description:</strong> <%= @feed.description %></p>
  <p><strong>Last Fetched:</strong> <%= @feed.last_fetched_at ? time_ago_in_words(@feed.last_fetched_at) + ' ago' : 'Never' %></p>
  <p><strong>Status:</strong> <%= @feed.status || 'Not fetched' %></p>
  <p><strong>RSS Feed URL:</strong> <%= link_to collection_feed_url(@collection, @feed, format: :rss), collection_feed_url(@collection, @feed, format: :rss) %></p>
</div>

<div class="actions">
  <%= link_to 'Edit', edit_collection_feed_path(@collection, @feed), class: 'btn btn-primary' %>
  <%= button_to 'Refresh Feed', refresh_collection_feed_path(@collection, @feed), method: :post, class: 'btn btn-info' %>
  <%= link_to 'Back to Feeds', collection_feeds_path(@collection), class: 'btn btn-secondary' %>
</div>

<% if @feed.items.present? %>
  <h2>Feed Items</h2>
  <div class="feed-items">
    <% @feed.items.each do |item| %>
      <div class="feed-item">
        <h3><%= link_to item["title"], item["link"], target: '_blank' %></h3>
        <p class="feed-item-date"><%= item["published_at"] ? Time.parse(item["published_at"]).strftime("%B %d, %Y at %I:%M %p") : 'No date' %></p>
        <div class="feed-item-description">
          <%= sanitize item["description"] %>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <p>No items in this feed yet.</p>
<% end %> 